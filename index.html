<!doctype html>
<html lang="pt-BR">
<head>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Complexo RJ ‚Äî Tabela de Puni√ß√µes</title>
<link rel="icon" href="icon.gif" />
<style>
:root{
  --orange:#ffaa01;
  --bg:#000;
  --card:#0b0b0b;
  --muted:#cfcfcf;
  --neon-shadow: 0 0 28px rgba(255,170,1,0.12);
  font-family: "Poppins", Inter, "Segoe UI", Roboto, Arial, sans-serif;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(800px 200px at 10% 10%, rgba(255,170,1,0.03), transparent),
    linear-gradient(180deg,#050505 0%, #070707 100%);
  color:#fff;
  -webkit-font-smoothing:antialiased;
  transition:background .3s ease,color .3s ease;
}

/* tema claro */
body.light-theme{
  background:
    radial-gradient(800px 200px at 10% 10%, rgba(255,170,1,0.12), transparent),
    linear-gradient(180deg,#f7f7f9,#e3e3ea);
  color:#111;
}
body.light-theme .search-box{
  background:#ffffff;
  border-color:rgba(0,0,0,0.06);
  box-shadow:0 10px 26px rgba(0,0,0,0.12);
}
body.light-theme .table{
  background:linear-gradient(180deg,#ffffff,#f5f5f7);
  box-shadow:0 10px 26px rgba(0,0,0,0.10);
}
body.light-theme .table td{
  border-bottom:1px solid rgba(0,0,0,0.06);
  color:#111;
}
body.light-theme .tr-hover:hover td{
  background:rgba(0,0,0,0.03);
}
body.light-theme header{
  border-bottom-color:var(--orange);
}
body.light-theme .modal{
  background:linear-gradient(180deg,#ffffff,#f4f4f6);
  color:#111;
}
body.light-theme .admin-item{
  background:#f7f7f9;
}
body.light-theme .log-list{
  background:#f3f3f7;
}

/* header/banner */
header{
  height:260px;
  background:url('back.gif') center/cover no-repeat;
  display:flex;align-items:end;padding:20px;border-bottom:3px solid var(--orange);
  box-shadow:var(--neon-shadow);
}
.header-inner{max-width:1150px;margin:0 auto;width:100%;display:flex;align-items:center;justify-content:space-between;gap:18px}
.brand{display:flex;align-items:center;gap:14px}
.logo{width:66px;height:66px;border-radius:12px;background:url('icon.gif') center/cover no-repeat;box-shadow:0 0 14px rgba(255,170,1,0.18)}
.brand h1{margin:0;font-size:26px;color:var(--orange);letter-spacing:.4px;text-shadow:0 0 8px rgba(255,170,1,0.08)}
.brand p{margin:0;font-size:13px;color:#d6d6d6}

/* admin + theme button top-right */
.header-actions{display:flex;gap:10px;align-items:center}
.btn{border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-family:inherit;font-size:13px}
.btn-primary{background:var(--orange);color:#000;font-weight:800;box-shadow:0 8px 36px rgba(255,170,1,0.12)}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.12);color:var(--orange)}
body.light-theme .btn-ghost{
  border-color:rgba(0,0,0,0.12);
}

/* main layout */
.wrap{max-width:1150px;margin:18px auto;padding:12px 20px}
.section{
  margin-bottom:36px;
  opacity:0;
  transform:translateY(28px);
  transition:0.7s cubic-bezier(.2,.9,.3,1);
}
.section.show{
  opacity:1;
  transform:translateY(0);
}
.title{font-size:28px;color:var(--orange);font-weight:800;margin-bottom:8px;text-shadow:0 0 8px rgba(255,170,1,0.06)}
.lead{color:#d4d4d4;line-height:1.6}
body.light-theme .lead{color:#444}

/* search */
.search-wrap{display:flex;justify-content:center;margin:6px 0 18px}
.search-box{
  width:100%;max-width:720px;background:#0f0f0f;border-radius:12px;padding:10px 12px;
  border:1px solid rgba(255,255,255,0.06);
  box-shadow:inset 0 6px 18px rgba(0,0,0,0.6);
  position:relative;
}
.search-box input{
  width:100%;background:transparent;border:0;color:#fff;
  padding:6px;font-size:16px;outline:none;
}
body.light-theme .search-box input{color:#111}

/* dropdown de sugest√µes */
.search-suggest{
  position:absolute;
  left:0;right:0;
  top:100%;
  margin-top:6px;
  background:#050505;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.08);
  box-shadow:0 18px 45px rgba(0,0,0,0.75);
  list-style:none;
  padding:6px 0;
  max-height:220px;
  overflow:auto;
  z-index:9999;
  display:none;
}
body.light-theme .search-suggest{
  background:#ffffff;
  border-color:rgba(0,0,0,0.08);
  box-shadow:0 18px 45px rgba(0,0,0,0.18);
}
.search-suggest li{
  padding:8px 12px;
  font-size:13px;
  color:#f5f5f5;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:6px;
  transition:background .18s ease, transform .18s ease, opacity .18s ease;
}
body.light-theme .search-suggest li{color:#222}
.search-suggest li span.hint{
  opacity:.6;
  font-size:11px;
}
.search-suggest li:hover{
  background:rgba(255,255,255,0.06);
  transform:translateY(-1px);
}
body.light-theme .search-suggest li:hover{
  background:rgba(0,0,0,0.04);
}

/* table */
.table{
  margin-top:14px;border-collapse:collapse;width:100%;
  background:linear-gradient(180deg,#0c0c0c,#070707);
  border-radius:12px;
  overflow:visible;
  box-shadow:0 10px 30px rgba(0,0,0,0.6);
  position:relative;
}
.table th{
  background:var(--orange);color:#000;padding:12px 14px;text-align:left;font-weight:800;
  cursor:pointer;user-select:none;position:relative;z-index:1;
}
.table th span.sort-label{font-weight:800}
.table th span.sort-indicator{font-size:11px;opacity:.65;margin-left:4px}
.table td{
  padding:12px 14px;
  border-bottom:1px solid rgba(255,255,255,0.03);
  color:#fff;
  position:relative;
}
.category{margin-top:26px;font-size:20px;color:var(--orange);font-weight:800;margin-bottom:10px}
.tr-hover:hover td{background:#0f0f0f}

/* anima√ß√£o por linha (cascata) */
.table tbody tr{
  opacity:0;
  transform:translateY(6px);
}
.table tbody tr.row-visible{
  animation:rowFade .45s cubic-bezier(.2,.9,.3,1) forwards;
}
@keyframes rowFade{
  from{opacity:0; transform:translateY(10px);}
  to{opacity:1; transform:translateY(0);}
}

/* badge + tooltip */
.badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:20px;
  height:20px;
  border-radius:999px;
  font-size:11px;
  margin-right:6px;
  padding:0 6px;
  background:rgba(255,255,255,0.08);
  box-shadow:0 0 12px rgba(0,0,0,0.7);
  position:relative;
}
.badge-ban{background:rgba(255,0,0,0.15);}
.badge-prisao{background:rgba(0,140,255,0.15);}
.badge-adv{background:rgba(255,215,0,0.15);}
.badge-adv-verbal{background:rgba(186,85,211,0.18);}

/* tooltip simples */
.badge[data-tooltip]::after{
  content:attr(data-tooltip);
  position:absolute;
  bottom:130%;
  left:50%;
  transform:translateX(-50%);
  background:#000;
  color:#fff;
  font-size:11px;
  padding:4px 8px;
  border-radius:6px;
  white-space:nowrap;
  opacity:0;
  pointer-events:none;
  transition:opacity .18s ease, transform .18s ease;
  z-index:99999;
  box-shadow:0 10px 26px rgba(0,0,0,0.7);
}
.badge[data-tooltip]::before{
  content:"";
  position:absolute;
  bottom:120%;
  left:50%;
  transform:translateX(-50%);
  border-width:6px;
  border-style:solid;
  border-color:#000 transparent transparent transparent;
  opacity:0;
  transition:opacity .18s ease;
  z-index:99998;
}
.badge:hover::after,
.badge:hover::before{
  opacity:1;
}
.badge:hover::after{
  transform:translate(-50%,-2px);
}

/* modal / admin */
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(5px);display:none;align-items:center;justify-content:center;z-index:1500}
.modal{background:linear-gradient(180deg,#0b0b0b,#0a0a0a);border-radius:12px;padding:18px;max-width:1100px;width:96%;box-shadow:0 14px 40px rgba(0,0,0,0.7),0 0 28px rgba(255,170,1,0.08);color:#ddd}

/* admin list/editor */
.admin-list{max-height:55vh;overflow:auto;padding-right:6px}
.admin-item{background:#0f0f0f;padding:12px;border-radius:10px;margin-bottom:10px;border:1px solid rgba(255,255,255,0.02)}
.admin-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
.input-inline{background:#111;border:1px solid rgba(255,255,255,0.03);color:#fff;padding:8px;border-radius:8px}

/* small controls */
.controls-row{display:flex;gap:8px;align-items:center}
.file-input{display:none}

/* logs */
.log-list{max-height:220px;overflow:auto;background:#090909;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
.log-item{font-size:13px;color:#cfcfcf;padding:6px;border-bottom:1px dashed rgba(255,255,255,0.02)}

/* little helpers */
.kv{font-size:13px;color:#bfbfbf}
.btn-small{padding:6px 8px;border-radius:8px;border:0}

/* anima√ß√£o slide+fade ao recriar conte√∫do (busca) */
.animate-search{
  animation:slideFade .45s cubic-bezier(.2,.9,.3,1);
}
@keyframes slideFade{
  from{opacity:0; transform:translateY(18px);}
  to{opacity:1; transform:translateY(0);}
}

/* responsive */
@media (max-width:720px){
  header{height:200px}
  .brand h1{font-size:18px}
  .modal{width:94%}
  .search-box{max-width:92%}
}
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Complexo RJ ‚Äî Tabela de Puni√ß√µes</h1>
        <p class="lead">Guia transparente de penalidades e regras aplicadas na comunidade</p>
      </div>
    </div>

    <div class="header-actions">
      <button id="themeToggle" class="btn btn-ghost" title="Alternar tema">‚òÄÔ∏è</button>
      <button id="openAdminBtn" class="btn btn-primary" title="Painel Admin">Painel Admin</button>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="section">
    <div class="title">Tabela de Puni√ß√µes</div>
    <p class="lead">A Tabela de Puni√ß√µes do Complexo RJ foi criada com o objetivo de manter a ordem, disciplina e o bom funcionamento da nossa comunidade. Cada membro deve respeitar as diretrizes para um ambiente justo e organizado.</p>
  </section>

  <section class="section search-wrap">
    <div class="search-box">
      <input id="searchField" placeholder="Pesquisar infra√ß√£o, puni√ß√£o ou categoria (ex.: RDM, Banimento)..." autocomplete="off" />
      <ul id="searchSuggest" class="search-suggest"></ul>
    </div>
  </section>

  <section id="contentArea" class="section"></section>
</main>

<div id="loginModal" class="modal-back" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <h3 style="color:var(--orange);margin:0 0 10px">Login Administrativo</h3>
    <p style="color:#cfcfcf;margin:0 0 12px">Insira a senha para acessar o painel.</p>
    <div style="display:flex;gap:8px;align-items:center">
      <input id="adminPass" type="password" placeholder="Senha" class="input-inline" style="flex:1" />
      <button id="loginBtn" class="btn btn-primary">Entrar</button>
    </div>
    <div style="display:flex;justify-content:flex-end;margin-top:12px">
      <button id="loginClose" class="btn btn-ghost">Fechar</button>
    </div>
  </div>
</div>

<div id="adminModal" class="modal-back" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <h3 style="color:var(--orange);margin:0 0 10px">Painel Administrativo</h3>

    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;align-items:center">
      <button id="addNewBtn" class="btn btn-primary">+ Nova Puni√ß√£o</button>
      <label class="btn btn-ghost" style="cursor:pointer">
        Importar JSON
        <input id="importFile" type="file" accept=".json" class="file-input" />
      </label>
      <button id="exportBtn" class="btn btn-ghost">Exportar JSON</button>
      <button id="restoreBtn" class="btn btn-ghost">Restaurar Padr√£o</button>

      <div style="flex:1"></div>

      <div style="display:flex;gap:8px;align-items:center">
        <span class="kv">Token:</span>
        <button id="regenTokenBtn" class="btn btn-ghost">Regenerar</button>
        <button id="closeAdminBtn" class="btn btn-ghost">Fechar</button>
      </div>
    </div>

    <div style="display:flex;gap:16px">
      <div style="flex:1">
        <div class="admin-list" id="adminList"></div>
        <div style="display:flex;justify-content:center;margin-top:12px">
          <button id="saveAdminBtn" class="btn btn-primary">Salvar altera√ß√µes</button>
        </div>
      </div>

      <div style="width:320px;">
        <div style="margin-bottom:10px">
          <strong class="kv">Logs de a√ß√µes</strong>
          <div class="log-list" id="logList"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="clearLogsBtn" class="btn btn-ghost">Limpar logs</button>
            <button id="exportLogsBtn" class="btn btn-ghost">Exportar logs</button>
          </div>
        </div>

        <div style="margin-top:18px">
          <strong class="kv">Prote√ß√£o</strong>
          <p class="kv" style="margin:6px 0">O painel usa token SHA-256 em <code>sessionStorage</code> enquanto a sess√£o estiver ativa.</p>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="showTokenBtn" class="btn btn-ghost">Mostrar token</button>
            <button id="revokeTokenBtn" class="btn btn-ghost">Revogar</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* ----------------------------
    Config / storage helpers
    ---------------------------- */
const ADMIN_PASS = 'staff@22';
const STORAGE_KEY = 'punicoes';
const LOGS_KEY = 'punicoes_logs';

/* PUNI√á√ïES PADR√ÉO (vers√£o definitiva) */
const ORIGINAL_DATA = [
  {cat:"Pris√£o STAFF",inf:"√ÅUDIO ESTOURADO NA PRA√áA",pun:"50 meses de pris√£o"},
  {cat:"Pris√£o STAFF",inf:"USO INDEVIDO DO CALL ADM",pun:"500 meses de pris√£o"},
  {cat:"Tickets",inf:"BAIT/COPBAIT",pun:"Advert√™ncia 1 + 500 meses de pris√£o"},
  {cat:"Tickets",inf:"ABUSO DE PODER",pun:"Advert√™ncia 1"},
  {cat:"Tickets",inf:"LOOT INDEVIDO",pun:"Advert√™ncia Verbal"},
  {cat:"Tickets",inf:"REGRAS DE A√á√ïES E PISTA",pun:"Advert√™ncia verbal + 300 meses de pris√£o"},
  {cat:"Tickets",inf:"COMBAT LOGGING",pun:"Advert√™ncia + 2500 meses de pris√£o"},
  {cat:"Tickets",inf:"FLAMING",pun:"Advert√™ncia 1"},
  {cat:"Tickets",inf:"VDM",pun:"Advert√™ncia + 500 meses de pris√£o"},
  {cat:"Tickets",inf:"RDM",pun:"Advert√™ncia + 1000 meses de pris√£o"},
  {cat:"Tickets",inf:"ZARALHO / ANTI-RP",pun:"Advert√™ncia + 3000 meses de pris√£o"},
  {cat:"Tickets",inf:"CAIXA 2",pun:"Banimento"},
  {cat:"Tickets",inf:"POWER GAMING",pun:"Advert√™ncia Verbal"},
  {cat:"Tickets",inf:"META GAMING",pun:"Dupla advert√™ncia + 1000 meses de pris√£o"},
  {cat:"Tickets",inf:"QUEBRA DE IMERS√ÉO",pun:"100 meses de pris√£o"},
  {cat:"Tickets",inf:"LEMBRAR DE A√á√ÉO",pun:"100 meses de pris√£o"},
  {cat:"Tickets",inf:"MAL USO DO CHAT",pun:"50 meses ou Advert√™ncia Verbal"},
  {cat:"Tickets",inf:"REGRAS DE SAFE ZONE",pun:"Advert√™ncia Verbal + 100 meses"},
  {cat:"Tickets",inf:"ANTI AMOR √Ä VIDA",pun:"Advert√™ncia Verbal"},
  {cat:"Tickets",inf:"ABUSO DE BUG",pun:"Advert√™ncia Verbal + 300 months"},
  {cat:"Tickets",inf:"BIND EM A√á√ÉO",pun:"Advert√™ncia 1 + 1000 meses"},
  {cat:"Tickets",inf:"FAKE EMPREGO",pun:"100 meses ou Advert√™ncia Verbal"},
  {cat:"Tickets",inf:"FOR√áAR A√á√ÉO",pun:"Advert√™ncia Verbal + 1000 meses"},
  {cat:"Banimento com UNBAN",inf:"Excesso de Advert√™ncias",pun:"Banimento com direito a UNBAN"},
  {cat:"Banimento com UNBAN",inf:"RDM/VDM em massa",pun:"Banimento com direito a UNBAN"},
  {cat:"Banimento com UNBAN",inf:"Anti RP",pun:"Banimento com direito a UNBAN"},
  {cat:"Banimento com UNBAN",inf:"Desvio de itens de ba√∫",pun:"Banimento com direito a UNBAN"},
  {cat:"Banimento Permanente",inf:"DIVULGA√á√ÉO DE OUTROS SERVIDORES",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"DARK-RP",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"COM√âRCIO EXTERNO",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"CHEATS / SPOOFERS",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"CITIZENS COM VANTAGEM",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"√ìDIO OU XINGAR STAFF",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"ACOBERTAR CHEATERS",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"DIVULGAR NUDEZ",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"DISCRIMINA√á√ÉO EXTREMA",pun:"Banimento Permanente"}
];

/* ensure base exists: if no data saved yet, write original */
(function ensureBase(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(ORIGINAL_DATA));
    } else {
      const parsed = JSON.parse(raw);
      if(!Array.isArray(parsed)) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(ORIGINAL_DATA));
      }
    }
  }catch(e){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(ORIGINAL_DATA));
  }
})();

function loadData(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }catch(e){ return JSON.parse(JSON.stringify(ORIGINAL_DATA)); } }
function saveData(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
function loadLogs(){ try{ return JSON.parse(localStorage.getItem(LOGS_KEY) || '[]'); }catch(e){ return []; } }
function pushLog(action, details){ const logs=loadLogs(); logs.unshift({ts:new Date().toISOString(), action, details}); localStorage.setItem(LOGS_KEY, JSON.stringify(logs)); }

/* ----------------------------
    Tema claro/escuro
    ---------------------------- */
const themeToggle = document.getElementById('themeToggle');
function applyTheme(theme){
  if(theme === 'light'){
    document.body.classList.add('light-theme');
    themeToggle.textContent = 'üåô';
  }else{
    document.body.classList.remove('light-theme');
    themeToggle.textContent = '‚òÄÔ∏è';
  }
}
const savedTheme = localStorage.getItem('punicoes_theme') || 'dark';
applyTheme(savedTheme);

themeToggle.addEventListener('click', ()=>{
  const current = document.body.classList.contains('light-theme') ? 'light' : 'dark';
  const next = current === 'light' ? 'dark' : 'light';
  localStorage.setItem('punicoes_theme', next);
  applyTheme(next);
});

/* ----------------------------
    Public render & search
    ---------------------------- */
const contentArea = document.getElementById('contentArea');
const searchField = document.getElementById('searchField');
const searchSuggest = document.getElementById('searchSuggest');

let DATA = loadData();

/* observer das sections */
const revealObserver = new IntersectionObserver((entries)=>{
  entries.forEach(en=>{
    if(en.isIntersecting){
      en.target.classList.add('show');
    }
  });
},{threshold:0.12});

function observeSections(){
  document.querySelectorAll('.section').forEach(sec=>revealObserver.observe(sec));
}

function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* Badge com emoji e tooltip */
function formatPunicaoWithBadge(pun){
  const lower = pun.toLowerCase();
  let emoji = '';
  let tooltip = '';
  let badgeClass = '';

  if(lower.includes('banimento')){
    emoji = 'üî¥';
    tooltip = 'Banimento';
    badgeClass = 'badge-ban';
  }else if(lower.includes('pris√£o')){
    emoji = 'üîµ';
    tooltip = 'Pris√£o';
    badgeClass = 'badge-prisao';
  }else if(lower.includes('advert√™ncia verbal')){
    emoji = 'üü£';
    tooltip = 'Advert√™ncia verbal';
    badgeClass = 'badge-adv-verbal';
  }else if(lower.includes('advert√™ncia')){
    emoji = 'üü°';
    tooltip = 'Advert√™ncia';
    badgeClass = 'badge-adv';
  }

  if(!emoji){
    return '<span class="pun-text">' + escapeHtml(pun) + '</span>';
  }

  return '<span class="badge ' + badgeClass + '" data-tooltip="' + tooltip + '">' + emoji + '</span>' +
         '<span class="pun-text">' + escapeHtml(pun) + '</span>';
}

/* render p√∫blico */
function renderPublic(dataset){
  // anima√ß√£o ao pesquisar / recriar tabelas
  contentArea.classList.remove('animate-search');
  void contentArea.offsetWidth;
  contentArea.classList.add('animate-search');

  contentArea.innerHTML = '';
  const cats = [...new Set(dataset.map(x=>x.cat))];

  let rowIndex = 0; // para delay em cascata geral

  cats.forEach(cat=>{
    const sec = document.createElement('div');
    sec.className='section';

    const title = document.createElement('div');
    title.className='category';
    title.textContent=cat;
    sec.appendChild(title);

    const table = document.createElement('table');
    table.className='table';
    
    table.innerHTML = `
      <thead>
        <tr>
          <th data-sort="inf">
            <span class="sort-label">Infra√ß√£o</span>
            <span class="sort-indicator">‚Üï</span>
          </th>
          <th data-sort="pun">
            <span class="sort-label">Puni√ß√£o</span>
            <span class="sort-indicator">‚Üï</span>
          </th>
        </tr>
      </thead>
      <tbody></tbody>
    `;

    const tbody = table.querySelector('tbody'); 
    
    dataset
      .filter(x=>x.cat===cat)
      .forEach(item=>{
        const tr = document.createElement('tr');
        tr.className='tr-hover row-visible';
        tr.style.animationDelay = (rowIndex * 0.04) + 's';
        rowIndex++;

        const tdInf = document.createElement('td');
        tdInf.innerHTML = escapeHtml(item.inf);
        tdInf.style.color = '#fff';

        const tdPun = document.createElement('td');
        tdPun.innerHTML = formatPunicaoWithBadge(item.pun);
        tdPun.style.color = '#fff';

        tr.appendChild(tdInf);
        tr.appendChild(tdPun);
        tbody.appendChild(tr);
      });

    sec.appendChild(table);
    contentArea.appendChild(sec);
  });

  observeSections();
}

/* initial render */
renderPublic(DATA);
observeSections();

/* sugest√µes de busca (dropdown) */
function updateSuggestions(q){
  searchSuggest.innerHTML = '';
  if(!q){
    searchSuggest.style.display = 'none';
    return;
  }
  const lower = q.toLowerCase();
  const seen = new Set();
  const list = [];

  loadData().forEach(x=>{
    [x.inf,x.pun,x.cat].forEach(src=>{
      const txt = String(src || '');
      const low = txt.toLowerCase();
      if(low.includes(lower) && !seen.has(low)){
        seen.add(low);
        list.push(txt);
      }
    });
  });

  const top = list.slice(0,8);
  if(top.length === 0){
    searchSuggest.style.display = 'none';
    return;
  }

  top.forEach(item=>{
    const li = document.createElement('li');
    li.innerHTML = '<span>' + escapeHtml(item) + '</span><span class="hint">enter para aplicar</span>';
    li.addEventListener('mousedown', ()=>{
      searchField.value = item;
      searchField.dispatchEvent(new Event('input'));
      searchSuggest.style.display = 'none';
    });
    searchSuggest.appendChild(li);
  });

  searchSuggest.style.display = 'block';
}

/* busca com m√∫ltiplos termos (ex: "rdm pris√£o") */
searchField.addEventListener('input', e=>{
  const q = (e.target.value||'').trim().toLowerCase();

  updateSuggestions(q);

  if(!q){
    DATA = loadData();
    renderPublic(DATA);
    return;
  }

  const terms = q.split(/\s+/).filter(Boolean);

  const filtered = loadData().filter(x=>{
    const text = (x.inf + ' ' + x.pun + ' ' + x.cat).toLowerCase();
    return terms.every(t => text.includes(t));
  });

  renderPublic(filtered);
});

/* fechar dropdown ao clicar fora ou apertar Esc */
document.addEventListener('click', (e)=>{
  if(!searchSuggest.contains(e.target) && e.target !== searchField){
    searchSuggest.style.display = 'none';
  }
});
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    searchSuggest.style.display = 'none';
  }
});

/* Ordena√ß√£o de colunas por tabela (Infra√ß√£o / Puni√ß√£o) */
contentArea.addEventListener('click', (e)=>{
  const th = e.target.closest('th[data-sort]');
  if(!th) return;

  const table = th.closest('table');
  if(!table) return;

  const tbody = table.querySelector('tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  if(rows.length === 0) return;

  const key = th.dataset.sort; // 'inf' ou 'pun'
  const cellIndex = key === 'inf' ? 0 : 1;

  const currentDir = th.dataset.dir === 'asc' ? 'asc' : (th.dataset.dir === 'desc' ? 'desc' : null);
  const newDir = !currentDir || currentDir === 'desc' ? 'asc' : 'desc';
  th.dataset.dir = newDir;

  rows.sort((a,b)=>{
    const aText = (a.cells[cellIndex].innerText || '').toLowerCase();
    const bText = (b.cells[cellIndex].innerText || '').toLowerCase();
    if(aText < bText) return newDir === 'asc' ? -1 : 1;
    if(aText > bText) return newDir === 'asc' ? 1 : -1;
    return 0;
  });

  rows.forEach((row, idx)=>{
    row.style.animationDelay = (idx * 0.03) + 's';
    tbody.appendChild(row);
  });
});

/* ----------------------------
    Admin UI & Auth
    ---------------------------- */
const openAdminBtn = document.getElementById('openAdminBtn');
const loginModal = document.getElementById('loginModal');
const adminModal = document.getElementById('adminModal');
const adminPassInput = document.getElementById('adminPass');
const loginBtn = document.getElementById('loginBtn');
const loginClose = document.getElementById('loginClose');

openAdminBtn.addEventListener('click', ()=>{
  adminPassInput.value='';
  loginModal.style.display='flex';
  loginModal.setAttribute('aria-hidden','false');
  setTimeout(()=>adminPassInput.focus(),80);
});
loginClose.addEventListener('click', ()=>{
  loginModal.style.display='none';
  loginModal.setAttribute('aria-hidden','true');
});

loginBtn.addEventListener('click', async ()=>{
  const val = adminPassInput.value || '';
  if(val === ADMIN_PASS){
    const token = await generateToken(val);
    sessionStorage.setItem('punicoes_token', token);
    pushLog('LOGIN','Admin logado');
    loginModal.style.display='none';
    openAdminPanel();
  } else {
    alert('Senha incorreta');
    adminPassInput.focus();
  }
});

/* close modal if clicked outside */
document.querySelectorAll('.modal-back').forEach(back=>{
  back.addEventListener('click', (e)=>{
    if(e.target === back){
      back.style.display='none';
      back.setAttribute('aria-hidden','true');
    }
  });
});

/* token utils (Web Crypto SHA-256) */
async function generateToken(password){
  const nonce = Math.random().toString(36).slice(2,12);
  const text = password + '::' + nonce + '::' + Date.now();
  const enc = new TextEncoder().encode(text);
  const hash = await crypto.subtle.digest('SHA-256', enc);
  const hex = Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
  return hex;
}
function tokenValid(){ return !!sessionStorage.getItem('punicoes_token'); }

/* token UI */
document.getElementById('regenTokenBtn').addEventListener('click', async ()=>{
  if(!tokenValid()) return alert('Sem sess√£o ativa.');
  const t = await generateToken(ADMIN_PASS);
  sessionStorage.setItem('punicoes_token', t);
  pushLog('TOKEN','Token regenerado');
  alert('Token regenerado.');
});
document.getElementById('showTokenBtn').addEventListener('click', ()=>{
  alert(sessionStorage.getItem('punicoes_token') || 'N√£o autenticado.');
});
document.getElementById('revokeTokenBtn').addEventListener('click', ()=>{
  sessionStorage.removeItem('punicoes_token');
  pushLog('TOKEN','Token revogado');
  alert('Token revogado.');
});

/* ----------------------------
    Admin Panel Logic (editor / CRUD / import-export / logs)
    ---------------------------- */
const adminListEl = document.getElementById('adminList');
const logListEl = document.getElementById('logList');
const addNewBtn = document.getElementById('addNewBtn');
const importFile = document.getElementById('importFile');
const exportBtn = document.getElementById('exportBtn');
const restoreBtn = document.getElementById('restoreBtn');
const saveAdminBtn = document.getElementById('saveAdminBtn');
const closeAdminBtn = document.getElementById('closeAdminBtn');
const clearLogsBtn = document.getElementById('clearLogsBtn');
const exportLogsBtn = document.getElementById('exportLogsBtn');

function openAdminPanel(){
  if(!tokenValid()){
    return alert('Sess√£o inv√°lida. Fa√ßa login novamente.');
  }
  DATA = loadData();
  renderAdminList();
  renderLogs();
  adminModal.style.display='flex';
  adminModal.setAttribute('aria-hidden','false');
  pushLog('OPEN_ADMIN','Painel aberto');
}
closeAdminBtn.addEventListener('click', ()=>{
  adminModal.style.display='none';
  adminModal.setAttribute('aria-hidden','true');
  pushLog('CLOSE_ADMIN','Painel fechado');
});

function renderAdminList(){
  adminListEl.innerHTML = '';
  DATA.forEach((item, idx) => {
    const node = document.createElement('div');
    node.className = 'admin-item';
    node.innerHTML = `
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <input class="input-inline" data-idx="${idx}" data-field="cat" value="${escapeHtml(item.cat)}" />
        <input class="input-inline" data-idx="${idx}" data-field="inf" value="${escapeHtml(item.inf)}" style="flex:1" />
        <input class="input-inline" data-idx="${idx}" data-field="pun" value="${escapeHtml(item.pun)}" style="min-width:220px" />
      </div>
      <div class="admin-actions">
        <button class="btn btn-ghost" data-action="up" data-idx="${idx}">‚áß</button>
        <button class="btn btn-ghost" data-action="down" data-idx="${idx}">‚á©</button>
        <button class="btn btn-ghost" data-action="dup" data-idx="${idx}">Duplicar</button>
        <button class="btn btn-ghost" data-action="saveone" data-idx="${idx}">Salvar</button>
        <button class="btn" data-action="del" data-idx="${idx}" style="background:#9b1d1d;color:#fff">Excluir</button>
      </div>
    `;
    adminListEl.appendChild(node);
  });

  // inputs binding
  adminListEl.querySelectorAll('input[data-idx]').forEach(inp=>{
    inp.addEventListener('input', e=>{
      const i = Number(e.target.dataset.idx);
      const f = e.target.dataset.field;
      DATA[i][f] = e.target.value;
    });
  });

  // buttons binding
  adminListEl.querySelectorAll('button[data-action]').forEach(b=>{
    b.addEventListener('click', e=>{
      const action = e.currentTarget.dataset.action;
      const i = Number(e.currentTarget.dataset.idx);
      if(action==='del'){
        if(!confirm('Remover esta puni√ß√£o?')) return;
        const removed = DATA.splice(i,1)[0];
        pushLog('DELETE', JSON.stringify(removed));
        renderAdminList();
      } else if(action==='up' && i>0){
        const a = DATA.splice(i,1)[0];
        DATA.splice(i-1,0,a);
        renderAdminList();
      } else if(action==='down' && i < DATA.length-1){
        const a = DATA.splice(i,1)[0];
        DATA.splice(i+1,0,a);
        renderAdminList();
      } else if(action==='dup'){
        const copy = JSON.parse(JSON.stringify(DATA[i]));
        DATA.splice(i+1,0,copy);
        pushLog('DUPLICATE',JSON.stringify(copy));
        renderAdminList();
      } else if(action==='saveone'){
        saveData(DATA);
        pushLog('SAVE_ONE', `index:${i}`);
        alert('Salvo!');
      }
    });
  });
}

/* add new */
addNewBtn.addEventListener('click', ()=>{
  const cat = prompt('Categoria (ex: Tickets, Pris√£o STAFF, Banimento Permanente):','Tickets') || 'Tickets';
  const inf = prompt('Descri√ß√£o da infra√ß√£o:','Nova infra√ß√£o') || 'Nova infra√ß√£o';
  const pun = prompt('Puni√ß√£o aplicada:','Advert√™ncia') || 'Advert√™ncia';
  const obj = {cat,inf,pun};
  DATA.unshift(obj);
  pushLog('ADD', JSON.stringify(obj));
  renderAdminList();
  adminListEl.scrollTop = 0;
});

/* import */
importFile.addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = (ev)=>{
    try{
      const parsed = JSON.parse(ev.target.result);
      if(!Array.isArray(parsed)) throw new Error('Arquivo inv√°lido');
      const option = confirm('Substituir tudo pelas puni√ß√µes do arquivo? (OK = substituir, Cancel = mesclar)');
      if(option){
        DATA = parsed;
        saveData(DATA);
        pushLog('IMPORT_REPLACE', `count:${parsed.length}`);
      } else {
        DATA = parsed.concat(DATA);
        saveData(DATA);
        pushLog('IMPORT_MERGE', `imported:${parsed.length}`);
      }
      renderAdminList();
      renderPublic(DATA);
      alert('Importa√ß√£o conclu√≠da.');
    }catch(err){
      alert('Erro ao importar JSON: ' + err.message);
    }
  };
  reader.readAsText(f);
  e.target.value = '';
});

/* export */
exportBtn.addEventListener('click', ()=>{
  const arr = loadData();
  const blob = new Blob([JSON.stringify(arr, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'punicoes_export.json';
  a.click();
  URL.revokeObjectURL(url);
  pushLog('EXPORT', `count:${arr.length}`);
});

/* restore */
restoreBtn.addEventListener('click', ()=>{
  if(!confirm('Restaurar padr√£o? Isso sobrescrever√° os dados atuais.')) return;
  DATA = JSON.parse(JSON.stringify(ORIGINAL_DATA));
  saveData(DATA);
  renderAdminList();
  renderPublic(DATA);
  pushLog('RESTORE','Restaurado para padr√£o');
  alert('Padr√£o restaurado.');
});

/* save all */
saveAdminBtn.addEventListener('click', ()=>{
  saveData(DATA);
  renderPublic(DATA);
  pushLog('SAVE_ALL', `count:${DATA.length}`);
  alert('Todas altera√ß√µes salvas no localStorage.');
});

/* logs UI */
function renderLogs(){
  const logs = loadLogs();
  logListEl.innerHTML = '';
  logs.forEach(l=>{
    const div = document.createElement('div');
    div.className='log-item';
    div.innerHTML = `
      <div style="color:#9f9f9f;font-size:12px">
        ${new Date(l.ts).toLocaleString()}
      </div>
      <div style="margin-top:4px">
        ${escapeHtml(l.action)} ‚Äî ${escapeHtml(l.details||'')}
      </div>`;
    logListEl.appendChild(div);
  });
}
clearLogsBtn.addEventListener('click', ()=>{
  if(!confirm('Limpar todos os logs?')) return;
  localStorage.removeItem(LOGS_KEY);
  renderLogs();
  alert('Logs apagados.');
});
exportLogsBtn.addEventListener('click', ()=>{
  const logs = loadLogs();
  const blob = new Blob([JSON.stringify(logs, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'punicoes_logs.json';
  a.click();
  URL.revokeObjectURL(url);
  pushLog('EXPORT_LOGS', `count:${logs.length}`);
});

/* initial logs render */
renderLogs();

/* final safety: if storage corrupted, reset */
try{
  const check = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
  if(check && !Array.isArray(check)){
    localStorage.removeItem(STORAGE_KEY);
    saveData(JSON.parse(JSON.stringify(ORIGINAL_DATA)));
    DATA = loadData();
    renderPublic(DATA);
  }
}catch(e){
  localStorage.removeItem(STORAGE_KEY);
  saveData(JSON.parse(JSON.stringify(ORIGINAL_DATA)));
  DATA = loadData();
  renderPublic(DATA);
}
</script>
</body>
</html>
