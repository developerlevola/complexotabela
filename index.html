<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Complexo RJ — Tabela de Punições</title>
<link rel="icon" href="icon.gif" />
<style>
:root{
  --orange:#ffaa01;
  --bg:#000;
  --card:#0b0b0b;
  --muted:#cfcfcf;
  --neon-shadow: 0 0 28px rgba(255,170,1,0.12);
  font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(800px 200px at 10% 10%, rgba(255,170,1,0.03), transparent),
    linear-gradient(180deg,#050505 0%, #070707 100%);
  color:#fff;
  -webkit-font-smoothing:antialiased;
}

/* header/banner */
header{
  height:260px;
  background:url('back.gif') center/cover no-repeat;
  display:flex;align-items:end;padding:20px;border-bottom:3px solid var(--orange);
  box-shadow:var(--neon-shadow);
}
.header-inner{max-width:1150px;margin:0 auto;width:100%;display:flex;align-items:center;justify-content:space-between;gap:18px}
.brand{display:flex;align-items:center;gap:14px}
.logo{width:66px;height:66px;border-radius:12px;background:url('icon.gif') center/cover no-repeat;box-shadow:0 0 14px rgba(255,170,1,0.18)}
.brand h1{margin:0;font-size:26px;color:var(--orange);letter-spacing:.4px;text-shadow:0 0 8px rgba(255,170,1,0.08)}
.brand p{margin:0;font-size:13px;color:#d6d6d6}

/* main layout */
.wrap{max-width:1150px;margin:18px auto;padding:12px 20px}
.section{margin-bottom:36px;opacity:0;transform:translateY(28px);transition:0.7s cubic-bezier(.2,.9,.3,1)}
.section.show{opacity:1;transform:translateY(0)}
.title{font-size:28px;color:var(--orange);font-weight:800;margin-bottom:8px;text-shadow:0 0 8px rgba(255,170,1,0.06)}
.lead{color:#d4d4d4;line-height:1.6}

/* search */
.search-wrap{display:flex;justify-content:center;margin:6px 0 18px}
.search-box{width:100%;max-width:720px;background:#0f0f0f;border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.02);box-shadow:inset 0 6px 18px rgba(0,0,0,0.6)}
.search-box input{width:100%;background:transparent;border:0;color:#fff;padding:6px;font-size:16px;outline:none}

/* table */
.table{margin-top:14px;border-collapse:collapse;width:100%;background:linear-gradient(180deg,#0c0c0c,#070707);border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
.table th{background:var(--orange);color:#000;padding:12px 14px;text-align:left;font-weight:800}
.table td{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.03);color:#fff}
.category{margin-top:26px;font-size:20px;color:var(--orange);font-weight:800;margin-bottom:10px}
.tr-hover:hover td{background:#0f0f0f}

/* modal */
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(5px);display:none;align-items:center;justify-content:center;z-index:1500}
.modal{background:linear-gradient(180deg,#0b0b0b,#0a0a0a);border-radius:12px;padding:18px;max-width:1100px;width:96%;box-shadow:0 14px 40px rgba(0,0,0,0.7),0 0 28px rgba(255,170,1,0.08);color:#ddd}

/* responsive */
@media (max-width:720px){
  header{height:200px}
  .brand h1{font-size:18px}
  .modal{width:94%}
  .search-box{max-width:92%}
}
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Complexo RJ — Tabela de Punições</h1>
        <p class="lead">Guia transparente de penalidades e regras aplicadas na comunidade</p>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="section">
    <div class="title">Tabela de Punições</div>
    <p class="lead">A Tabela de Punições do Complexo RJ foi criada com o objetivo de manter a ordem, disciplina e o bom funcionamento da nossa comunidade.</p>
  </section>

  <section class="section search-wrap">
    <div class="search-box">
      <input id="searchField" placeholder="Pesquisar infração, punição ou categoria..." />
    </div>
  </section>

  <section id="contentArea" class="section"></section>
</main>

<script>
/* --------------------------
   Reveal Animation Fix
--------------------------- */

let revealObserver = null;

function initReveal() {
  revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(en => {
      if (en.isIntersecting) {
        en.target.classList.add("show");
      }
    });
  }, { threshold: 0.12 });

  observeSections();
}

function observeSections() {
  document.querySelectorAll(".section").forEach(sec => {
    revealObserver.observe(sec);
  });
}

window.addEventListener("DOMContentLoaded", () => {
  initReveal();
});

/* ------------------------------
   STORAGE E SISTEMA ORIGINAL
------------------------------- */

const STORAGE_KEY = 'punicoes';

const ORIGINAL_DATA = [
  {cat:"Prisão STAFF",inf:"ÁUDIO ESTOURADO NA PRAÇA",pun:"50 meses de prisão"},
  {cat:"Prisão STAFF",inf:"USO INDEVIDO DO CALL ADM",pun:"500 meses de prisão"},
  {cat:"Tickets",inf:"BAIT/COPBAIT",pun:"Advertência 1 + 500 meses de prisão"},
  {cat:"Tickets",inf:"ABUSO DE PODER",pun:"Advertência 1"},
  {cat:"Tickets",inf:"LOOT INDEVIDO",pun:"Advertência Verbal"},
  {cat:"Tickets",inf:"REGRAS DE AÇÕES E PISTA",pun:"Advertência verbal + 300 meses de prisão"},
  {cat:"Tickets",inf:"COMBAT LOGGING",pun:"Advertência + 2500 meses de prisão"},
  {cat:"Tickets",inf:"FLAMING",pun:"Advertência 1"},
  {cat:"Tickets",inf:"VDM",pun:"Advertência + 500 meses de prisão"},
  {cat:"Tickets",inf:"RDM",pun:"Advertência + 1000 meses de prisão"},
  {cat:"Tickets",inf:"ZARALHO / ANTI-RP",pun:"Advertência + 3000 meses de prisão"},
  {cat:"Tickets",inf:"CAIXA 2",pun:"Banimento"},
  {cat:"Tickets",inf:"POWER GAMING",pun:"Advertência Verbal"},
  {cat:"Tickets",inf:"META GAMING",pun:"Dupla advertência + 1000 meses de prisão"},
  {cat:"Tickets",inf:"QUEBRA DE IMERSÃO",pun:"100 meses de prisão"},
  {cat:"Tickets",inf:"LEMBRAR DE AÇÃO",pun:"100 meses de prisão"},
  {cat:"Tickets",inf:"MAL USO DO CHAT",pun:"50 meses ou Advertência Verbal"},
  {cat:"Tickets",inf:"REGRAS DE SAFE ZONE",pun:"Advertência Verbal + 100 meses"},
  {cat:"Tickets",inf:"ANTI AMOR À VIDA",pun:"Advertência Verbal"},
  {cat:"Tickets",inf:"ABUSO DE BUG",pun:"Advertência Verbal + 300 meses"},
  {cat:"Tickets",inf:"BIND EM AÇÃO",pun:"Advertência 1 + 1000 meses"},
  {cat:"Tickets",inf:"FAKE EMPREGO",pun:"100 meses ou Advertência Verbal"},
  {cat:"Tickets",inf:"FORÇAR AÇÃO",pun:"Advertência Verbal + 1000 meses"},
  {cat:"Banimento com UNBAN",inf:"Excesso de Advertências",pun:"Banimento com direito a UNBAN"},
  {cat:"Banimento com UNBAN",inf:"RDM/VDM em massa",pun:"Banimento com direito a UNBAN"},
  {cat:"Banimento com UNBAN",inf:"Anti RP",pun:"Banimento com direito a UNBAN"},
  {cat:"Banimento com UNBAN",inf:"Desvio de itens de baú",pun:"Banimento com direito a UNBAN"},
  {cat:"Banimento Permanente",inf:"DIVULGAÇÃO DE OUTROS SERVIDORES",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"DARK-RP",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"COMÉRCIO EXTERNO",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"CHEATS / SPOOFERS",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"CITIZENS COM VANTAGEM",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"ÓDIO OU XINGAR STAFF",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"ACOBERTAR CHEATERS",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"DIVULGAR NUDEZ",pun:"Banimento Permanente"},
  {cat:"Banimento Permanente",inf:"DISCRIMINAÇÃO EXTREMA",pun:"Banimento Permanente"}
];

(function ensureBase(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) localStorage.setItem(STORAGE_KEY, JSON.stringify(ORIGINAL_DATA));
})();

function loadData(){ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }

const contentArea = document.getElementById('contentArea');
const searchField = document.getElementById('searchField');

/* ---------------------------
    Public Render FIXED
---------------------------- */

function renderPublic(dataset){
  contentArea.innerHTML = '';
  const cats = [...new Set(dataset.map(x=>x.cat))];

  cats.forEach(cat=>{
    const sec = document.createElement('div');
    sec.className='section';

    const title = document.createElement('div');
    title.className='category';
    title.textContent=cat;
    sec.appendChild(title);

    const table = document.createElement('table');
    table.className='table';

    table.innerHTML = `
      <thead>
        <tr>
          <th>Infração</th>
          <th>Punição</th>
        </tr>
      </thead>
      <tbody></tbody>
    `;

    const tbody = table.querySelector('tbody');

    dataset.filter(x=>x.cat===cat).forEach(item=>{
      const tr = document.createElement('tr');
      tr.className='tr-hover';

      const tdInf = document.createElement('td');
      tdInf.textContent = item.inf;
      tdInf.style.color = '#fff';

      const tdPun = document.createElement('td');
      tdPun.textContent = item.pun;
      tdPun.style.color = '#fff';

      tr.appendChild(tdInf);
      tr.appendChild(tdPun);
      tbody.appendChild(tr);
    });

    sec.appendChild(table);
    contentArea.appendChild(sec);
  });

  observeSections();
}

renderPublic(loadData());

/* search */
searchField.addEventListener('input', e=>{
  const q = (e.target.value||'').trim().toLowerCase();
  if(!q){ renderPublic(loadData()); return; }

  const filtered = loadData().filter(x=>{
    return x.inf.toLowerCase().includes(q) ||
           x.pun.toLowerCase().includes(q) ||
           x.cat.toLowerCase().includes(q);
  });

  renderPublic(filtered);
});
/* ----------------------------
    Admin UI & Auth
    ---------------------------- */
const openAdminBtn = document.getElementById('openAdminBtn');
const loginModal = document.getElementById('loginModal');
const adminModal = document.getElementById('adminModal');
const adminPassInput = document.getElementById('adminPass');
const loginBtn = document.getElementById('loginBtn');
const loginClose = document.getElementById('loginClose');

openAdminBtn.addEventListener('click', ()=>{ adminPassInput.value=''; loginModal.style.display='flex'; loginModal.setAttribute('aria-hidden','false'); setTimeout(()=>adminPassInput.focus(),80); });
loginClose.addEventListener('click', ()=>{ loginModal.style.display='none'; loginModal.setAttribute('aria-hidden','true'); });

loginBtn.addEventListener('click', async ()=>{
  const val = adminPassInput.value || '';
  if(val === ADMIN_PASS){
    const token = await generateToken(val);
    sessionStorage.setItem('punicoes_token', token);
    pushLog('LOGIN','Admin logado');
    loginModal.style.display='none';
    openAdminPanel();
  } else {
    alert('Senha incorreta');
    adminPassInput.focus();
  }
});

/* close modal if clicked outside */
document.querySelectorAll('.modal-back').forEach(back=>{
  back.addEventListener('click', (e)=>{ if(e.target === back){ back.style.display='none'; back.setAttribute('aria-hidden','true'); }});
});

/* token utils (Web Crypto SHA-256) */
async function generateToken(password){
  const nonce = Math.random().toString(36).slice(2,12);
  const text = password + '::' + nonce + '::' + Date.now();
  const enc = new TextEncoder().encode(text);
  const hash = await crypto.subtle.digest('SHA-256', enc);
  const hex = Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
  return hex;
}
function tokenValid(){ return !!sessionStorage.getItem('punicoes_token'); }

/* token UI */
document.getElementById('regenTokenBtn').addEventListener('click', async ()=>{
  if(!tokenValid()) return alert('Sem sessão ativa.');
  const t = await generateToken(ADMIN_PASS);
  sessionStorage.setItem('punicoes_token', t);
  pushLog('TOKEN','Token regenerado');
  alert('Token regenerado.');
});
document.getElementById('showTokenBtn').addEventListener('click', ()=>{ alert(sessionStorage.getItem('punicoes_token') || 'Não autenticado.'); });
document.getElementById('revokeTokenBtn').addEventListener('click', ()=>{ sessionStorage.removeItem('punicoes_token'); pushLog('TOKEN','Token revogado'); alert('Token revogado.'); });

/* ----------------------------
    Admin Panel Logic (editor / CRUD / import-export / logs)
    ---------------------------- */
const adminListEl = document.getElementById('adminList');
const logListEl = document.getElementById('logList');
const addNewBtn = document.getElementById('addNewBtn');
const importFile = document.getElementById('importFile');
const exportBtn = document.getElementById('exportBtn');
const restoreBtn = document.getElementById('restoreBtn');
const saveAdminBtn = document.getElementById('saveAdminBtn');
const closeAdminBtn = document.getElementById('closeAdminBtn');
const clearLogsBtn = document.getElementById('clearLogsBtn');
const exportLogsBtn = document.getElementById('exportLogsBtn');

function openAdminPanel(){
  if(!tokenValid()){ return alert('Sessão inválida. Faça login novamente.'); }
  DATA = loadData();
  renderAdminList();
  renderLogs();
  adminModal.style.display='flex'; adminModal.setAttribute('aria-hidden','false');
  pushLog('OPEN_ADMIN','Painel aberto');
}
closeAdminBtn.addEventListener('click', ()=>{ adminModal.style.display='none'; adminModal.setAttribute('aria-hidden','true'); pushLog('CLOSE_ADMIN','Painel fechado'); });

function renderAdminList(){
  adminListEl.innerHTML = '';
  DATA.forEach((item, idx) => {
    const node = document.createElement('div');
    node.className = 'admin-item';
    node.innerHTML = `
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <input class="input-inline" data-idx="${idx}" data-field="cat" value="${escapeHtml(item.cat)}" />
        <input class="input-inline" data-idx="${idx}" data-field="inf" value="${escapeHtml(item.inf)}" style="flex:1" />
        <input class="input-inline" data-idx="${idx}" data-field="pun" value="${escapeHtml(item.pun)}" style="min-width:220px" />
      </div>
      <div class="admin-actions">
        <button class="btn btn-ghost" data-action="up" data-idx="${idx}">⇧</button>
        <button class="btn btn-ghost" data-action="down" data-idx="${idx}">⇩</button>
        <button class="btn btn-ghost" data-action="dup" data-idx="${idx}">Duplicar</button>
        <button class="btn btn-ghost" data-action="saveone" data-idx="${idx}">Salvar</button>
        <button class="btn" data-action="del" data-idx="${idx}" style="background:#9b1d1d;color:#fff">Excluir</button>
      </div>
    `;
    adminListEl.appendChild(node);
  });

  // inputs binding
  adminListEl.querySelectorAll('input[data-idx]').forEach(inp=>{
    inp.addEventListener('input', e=>{
      const i = Number(e.target.dataset.idx);
      const f = e.target.dataset.field;
      DATA[i][f] = e.target.value;
    });
  });

  // buttons binding
  adminListEl.querySelectorAll('button[data-action]').forEach(b=>{
    b.addEventListener('click', e=>{
      const action = e.currentTarget.dataset.action;
      const i = Number(e.currentTarget.dataset.idx);
      if(action==='del'){
        if(!confirm('Remover esta punição?')) return;
        const removed = DATA.splice(i,1)[0];
        pushLog('DELETE', JSON.stringify(removed));
        renderAdminList();
      } else if(action==='up' && i>0){
        const a = DATA.splice(i,1)[0]; DATA.splice(i-1,0,a); renderAdminList();
      } else if(action==='down' && i < DATA.length-1){
        const a = DATA.splice(i,1)[0]; DATA.splice(i+1,0,a); renderAdminList();
      } else if(action==='dup'){
        const copy = JSON.parse(JSON.stringify(DATA[i])); DATA.splice(i+1,0,copy); pushLog('DUPLICATE',JSON.stringify(copy)); renderAdminList();
      } else if(action==='saveone'){
        saveData(DATA);
        pushLog('SAVE_ONE', `index:${i}`);
        alert('Salvo!');
      }
    });
  });
}

/* add new */
addNewBtn.addEventListener('click', ()=>{
  const cat = prompt('Categoria (ex: Tickets, Prisão STAFF, Banimento Permanente):','Tickets') || 'Tickets';
  const inf = prompt('Descrição da infração:','Nova infração') || 'Nova infração';
  const pun = prompt('Punição aplicada:','Advertência') || 'Advertência';
  const obj = {cat,inf,pun};
  DATA.unshift(obj);
  pushLog('ADD', JSON.stringify(obj));
  renderAdminList();
  adminListEl.scrollTop = 0;
});

/* import */
importFile.addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = (ev)=>{
    try{
      const parsed = JSON.parse(ev.target.result);
      if(!Array.isArray(parsed)) throw new Error('Arquivo inválido');
      const option = confirm('Substituir tudo pelas punições do arquivo? (OK = substituir, Cancel = mesclar)');
      if(option){
        DATA = parsed;
        saveData(DATA);
        pushLog('IMPORT_REPLACE', `count:${parsed.length}`);
      } else {
        DATA = parsed.concat(DATA);
        saveData(DATA);
        pushLog('IMPORT_MERGE', `imported:${parsed.length}`);
      }
      renderAdminList();
      renderPublic(DATA);
      alert('Importação concluída.');
    }catch(err){
      alert('Erro ao importar JSON: ' + err.message);
    }
  };
  reader.readAsText(f);
  e.target.value = '';
});

/* export */
exportBtn.addEventListener('click', ()=>{
  const arr = loadData();
  const blob = new Blob([JSON.stringify(arr, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'punicoes_export.json'; a.click(); URL.revokeObjectURL(url);
  pushLog('EXPORT', `count:${arr.length}`);
});

/* restore */
restoreBtn.addEventListener('click', ()=>{
  if(!confirm('Restaurar padrão? Isso sobrescreverá os dados atuais.')) return;
  DATA = JSON.parse(JSON.stringify(ORIGINAL_DATA));
  saveData(DATA);
  renderAdminList();
  renderPublic(DATA);
  pushLog('RESTORE','Restaurado para padrão');
  alert('Padrão restaurado.');
});

/* save all */
saveAdminBtn.addEventListener('click', ()=>{
  saveData(DATA);
  renderPublic(DATA);
  pushLog('SAVE_ALL', `count:${DATA.length}`);
  alert('Todas alterações salvas no localStorage.');
});

/* logs UI */
function renderLogs(){
  const logs = loadLogs();
  logListEl.innerHTML = '';
  logs.forEach(l=>{
    const div = document.createElement('div'); div.className='log-item';
    div.innerHTML = `<div style="color:#9f9f9f;font-size:12px">${new Date(l.ts).toLocaleString()}</div><div style="margin-top:4px">${escapeHtml(l.action)} — ${escapeHtml(l.details||'')}</div>`;
    logListEl.appendChild(div);
  });
}
clearLogsBtn.addEventListener('click', ()=>{
  if(!confirm('Limpar todos os logs?')) return;
  localStorage.removeItem(LOGS_KEY);
  renderLogs();
  alert('Logs apagados.');
});
exportLogsBtn.addEventListener('click', ()=>{
  const logs = loadLogs();
  const blob = new Blob([JSON.stringify(logs, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'punicoes_logs.json'; a.click(); URL.revokeObjectURL(url);
  pushLog('EXPORT_LOGS', `count:${logs.length}`);
});

/* initial logs render */
renderLogs();

/* final safety: if storage corrupted, reset */
try{
  const check = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
  if(check && !Array.isArray(check)){ localStorage.removeItem(STORAGE_KEY); saveData(JSON.parse(JSON.stringify(ORIGINAL_DATA))); DATA = loadData(); renderPublic(DATA); }
}catch(e){ localStorage.removeItem(STORAGE_KEY); saveData(JSON.parse(JSON.stringify(ORIGINAL_DATA))); DATA = loadData(); renderPublic(DATA); }


</script>
</body>
</html>
